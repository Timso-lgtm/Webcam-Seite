<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audioeingabe mit KI-Integration</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #transcript { border: 1px solid #ccc; padding: 10px; min-height: 50px; }
        #response { border: 1px solid #ccc; padding: 10px; min-height: 50px; margin-top: 20px; }
    </style>
</head>
<body>
    <h1>Audioeingabe für Website</h1>
    <button id="start-btn">Audioaufnahme starten</button>
    <button id="stop-btn" disabled>Stoppen</button>
    <div>
        <h3>Transkribierter Text:</h3>
        <div id="transcript"></div>
    </div>
    <div>
        <h3>KI-Antwort:</h3>
        <div id="response"></div>
    </div>

    <script>
        // Überprüfe, ob SpeechRecognition unterstützt wird
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) {
            alert('Dein Browser unterstützt keine Spracherkennung.');
        } else {
            const recognition = new SpeechRecognition();
            recognition.lang = 'de-DE'; // Sprache auf Deutsch setzen (anpassbar, z.B. 'en-US' für Englisch)
            recognition.continuous = false; // Stoppt nach einer Pause
            recognition.interimResults = false; // Nur finale Ergebnisse

            const startBtn = document.getElementById('start-btn');
            const stopBtn = document.getElementById('stop-btn');
            const transcriptDiv = document.getElementById('transcript');
            const responseDiv = document.getElementById('response');

            let isListening = false;

            // Start-Button
            startBtn.addEventListener('click', () => {
                recognition.start();
                isListening = true;
                startBtn.disabled = true;
                stopBtn.disabled = false;
                transcriptDiv.textContent = 'Höre zu...';
            });

            // Stop-Button
            stopBtn.addEventListener('click', () => {
                recognition.stop();
                isListening = false;
                startBtn.disabled = false;
                stopBtn.disabled = true;
            });

            // Ergebnis der Spracherkennung
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                transcriptDiv.textContent = transcript;
                
                // Text an KI senden
                sendToAI(transcript);
            };

            // Fehlerbehandlung
            recognition.onerror = (event) => {
                console.error('Spracherkennungsfehler:', event.error);
                transcriptDiv.textContent = 'Fehler bei der Erkennung.';
                startBtn.disabled = false;
                stopBtn.disabled = true;
            };

            // Funktion zum Senden an KI (Beispiel mit OpenAI API)
            async function sendToAI(text) {
                responseDiv.textContent = 'Lade Antwort...';
                
                try {
                    const response = await fetch('https://api.openai.com/v1/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer DEIN_API_SCHLÜSSEL_HIER' // Ersetze mit deinem OpenAI-API-Schlüssel
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo', // Oder ein anderes Modell
                            messages: [{ role: 'user', content: text }],
                            max_tokens: 150
                        })
                    });
                    
                    const data = await response.json();
                    if (data.choices && data.choices[0]) {
                        responseDiv.textContent = data.choices[0].message.content;
                    } else {
                        responseDiv.textContent = 'Fehler bei der KI-Antwort.';
                    }
                } catch (error) {
                    console.error('KI-API-Fehler:', error);
                    responseDiv.textContent = 'Fehler beim Laden der Antwort.';
                }
            }
        }
    </script>
</body>
</html>